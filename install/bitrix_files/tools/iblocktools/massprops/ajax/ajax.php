<?Header("Expires: Mon, 26 Jul 1997 05:00:00 GMT");Header("Cache-Control: no-cache, must-revalidate");Header("Pragma: no-cache");Header("Last-Modified: " . gmdate("D, d M Y H:i:s") . "GMT");require_once($_SERVER["DOCUMENT_ROOT"] . "/bitrix/modules/main/include/prolog_admin_before.php");require_once($_SERVER["DOCUMENT_ROOT"] . "/bitrix/modules/main/include/prolog_before.php");require_once($_SERVER["DOCUMENT_ROOT"] . "/bitrix/modules/iblock/iblock.php");require_once($_SERVER["DOCUMENT_ROOT"] . "/bitrix/modules/iblock/prolog.php");require_once($_SERVER['DOCUMENT_ROOT'] . '/bitrix/modules/main/interface/admin_lib.php');if(!$USER->isAdmin()) {    die();}if ($_REQUEST['ajax'] != 'Y') {    die();}CModule::IncludeModule('iblock');CModule::IncludeModule('fileman');CModule::IncludeModule('catalog');CModule::IncludeModule('sale');$APPLICATION->AddHeadScript('/bitrix/js/iblock/iblock_edit.js');?><style type="text/css">    table.multiaction td {        vertical-align: top;    }    .seprops_quant input[type=text]{        width: 30px;    }</style><?if ($_REQUEST['propID'] == 'PREVIEW_TEXT' || $_REQUEST['propID'] == 'DETAIL_TEXT') {    CFileMan::AddHTMLEditorFrame(            $_REQUEST['propID'], "", $_REQUEST['propID'] . "_TYPE", "",            array(                'height' => 450,                'width' => 700                    ), "N", 0, "", "", "", true, false, array(                'toolbarConfig' => CFileman::GetEditorToolbarConfig("iblock_" . (defined('BX_PUBLIC_MODE') && BX_PUBLIC_MODE == 1 ? 'public' : 'admin')),                'saveEditorKey' => $_REQUEST['iblockID']            )    );} elseif ($_REQUEST['propID'] == 'PREVIEW_TEXT_EXT' || $_REQUEST['propID'] == 'DETAIL_TEXT_EXT') {    ?>    <span>        &nbsp;<?= GetMessage('IBLOCKTOOLS_TEXT_EXT_INSERT'); ?><select name="<?= $_REQUEST['propID'] ?>_TYPE" id="">            <option value="start"><?= GetMessage('IBLOCKTOOLS_TEXT_EXT_BEG'); ?></option>            <option value="end"><?= GetMessage('IBLOCKTOOLS_TEXT_EXT_END'); ?></option>        </select>&nbsp;<?= GetMessage('IBLOCKTOOLS_TEXT_EXT_PHRASE'); ?>&nbsp;<input type="text" name="<?= $_REQUEST['propID'] ?>_TEXT" style="width: 300px;" />    </span><? } elseif ($_REQUEST['propID'] == 'TAGS') { ?>    <input type="text" name="<?= $_REQUEST['propID'] ?>" style="width: 300px;" />    <? } elseif ($_REQUEST['propID'] == 'DETAIL_PICTURE' || $_REQUEST['propID'] == 'PREVIEW_PICTURE') {    ?>    <span><?= GetMessage('IBLOCKTOOLS_PICTURE_FILE') ?><br/>    <?    echo CFileInput::Show(($_REQUEST['propID'] == 'PREVIEW_PICTURE' ? 'PREVIEW_PICTURE' : 'DETAIL_PICTURE'), ($ID > 0 && !$bCopy ? $str_DETAIL_PICTURE : 0), array(        "IMAGE" => "Y",        "PATH" => "Y",        "FILE_SIZE" => "Y",        "DIMENSIONS" => "Y",        "IMAGE_POPUP" => "Y",        "MAX_SIZE" => array(            "W" => COption::GetOptionString("iblock", "detail_image_size"),            "H" => COption::GetOptionString("iblock", "detail_image_size"),        ),            ), array(        'upload' => true,        'medialib' => true,        'file_dialog' => true,        'cloud' => true,        'del' => true,        'description' => true,            )    );    ?>    </span>    <? } elseif ($_REQUEST['propID'] == 'SORT') { ?>    <input type='text' id='sort' name="<?= $_REQUEST['propID'] ?>" value='' placeholder="<?= GetMessage('IBLOCKTOOLS_SORT') ?>" /><br />    </span>    <? } elseif ($_REQUEST['propID'] == 'NDS') { ?>    <div style='margin-top:7px; margin-left:5px;'><input type='checkbox' id='nds' name="<?= $_REQUEST['propID'] ?>" /><label for='nds'><?= GetMessage('IBLOCKTOOLS_NDS_YES') ?></label></div><br />    </span>    <? } elseif ($_REQUEST['propID'] == 'NACENKA') {          $db_ptype = GetCatalogGroups(Array("SORT" => "ASC"), Array());        ?>    <div style="float:left; width:120px;margin:0 0 0 5px;"><?= GetMessage('IBLOCKTOOLS_PRICE_TYPE') ?></div>    <select name="PRICE_TYPE" id="price_type">        <option value="0"><?= GetMessage('IBLOCKTOOLS_PRICE_TYPE_NO') ?></option>    <?    $i = 0;    while ($ptype = $db_ptype->Fetch()) {        //ne pokazivat base price        $i++;        if ($ptype["BASE"] != "Y") {            ?>                <option value="<?= $ptype["ID"] ?>"><?= $ptype["NAME_LANG"] ?></option>            <?            }        }        ?>    </select><br /><br />    <div style="float:left; width:120px;clear:both;margin:0 0 0 5px;"><?= GetMessage('IBLOCKTOOLS_NACENKA') ?>:</div>        <?= CExtra::SelectBox("NACENKA", 0, GetMessage('IBLOCKTOOLS_PRICE_TYPE_NO'), "ChangeExtra()", "class='typeselect'"); ?>    <div style="clear:both;margin:10px 0 0 5px;"><div style="float:left; width:115px;clear:both;margin:0 0 0 5px;clear:both;"><?= GetMessage('IBLOCKTOOLS_CURRENCY') ?>:</div>        <?= CCurrency::SelectBox("CURRENCY_DEFAULT", "RUB", "", True, "", "class='typeselect2'"); ?>    </div>    <?// UPDATE PRICE} elseif ($_REQUEST['propID'] == 'UPDATE_PRICE') {    $db_ptype = GetCatalogGroups(Array("SORT" => "ASC"), Array());    ?>    <div style="float:left; width:200px; margin:0 0 0 5px;"><?= GetMessage('IBLOCKTOOLS_PRICE_TYPE') ?>        <select name="PRICE_TYPE" id="price_type" style="width:130px;">            <option value="0"><?= GetMessage('IBLOCKTOOLS_PRICE_TYPE_NO') ?></option>    <?    $i = 0;    while ($ptype = $db_ptype->Fetch()) {        ?>                <option value="<?= $ptype["ID"] ?>"><?= $ptype["NAME_LANG"] ?></option>                <?            }            ?>        </select>    </div>    <div style="float:left; width:95px; margin:0 0 0 10px;">        <input type="text" value="" name="UPDATE_PRICE_PERCENT" style="width:60px;" /> %    </div>    <div style="float:left; width:100px; margin:0 0 0 5px;"><?= CCurrency::SelectBox("CURRENCY_DEFAULT", "RUB", "", True, "", "class='typeselect2'"); ?></div>    <br />    <div style="float:left; width:355px; margin: 10px 0 0 5px;"><label for="UPDATE_PRICE_SKU"><?= GetMessage('IBLOCKTOOLS_UPDATE_PRICE_SKU'); ?></label>: <input type="checkbox" value="Y" name="UPDATE_PRICE_SKU" id="UPDATE_PRICE_SKU" /></div>    <?} elseif ($_REQUEST['propID'] == 'UPDATE_PRICE_MINUS') {    $db_ptype = GetCatalogGroups(Array("SORT" => "ASC"), Array());    ?>    <div style="float:left; width:200px; margin:0 0 0 5px;"><?= GetMessage('IBLOCKTOOLS_PRICE_TYPE') ?>        <select name="PRICE_TYPE" id="price_type" style="width:130px;">            <option value="0"><?= GetMessage('IBLOCKTOOLS_PRICE_TYPE_NO') ?></option>    <?    $i = 0;    while ($ptype = $db_ptype->Fetch()) {        ?>                <option value="<?= $ptype["ID"] ?>"><?= $ptype["NAME_LANG"] ?></option>                <?            }            ?>        </select>    </div>    <div style="float:left; width:95px; margin:0 0 0 10px;">        <input type="text" value="" name="UPDATE_PRICE_PERCENT_MINUS" style="width:60px;" /> %    </div>    <div style="float:left; width:100px; margin:0 0 0 5px;"><?= CCurrency::SelectBox("CURRENCY_DEFAULT", "RUB", "", True, "", "class='typeselect2'"); ?></div>    <br />    <div style="float:left; width:355px; margin: 10px 0 0 5px;"><label for="UPDATE_PRICE_SKU"><?= GetMessage('IBLOCKTOOLS_UPDATE_PRICE_SKU'); ?></label>: <input type="checkbox" value="Y" name="UPDATE_PRICE_SKU_MINUS" id="UPDATE_PRICE_SKU" /></div>    <?} elseif ($_REQUEST['propID'] == 'OTHER_PRICE') {    if (CModule::IncludeModule('catalog')) {        ?>        <style type="text/css">            .seprops_currency input[type=text]{                width: 70px;            }            .seprops_currency p {                font-size: 100%;                margin: 0 0 10px 5px;            }        </style>        <?        //currency        $arCurrency = array();        $lcur = CCurrency::GetList(($b = "SORT"), ($order = "asc"), LANGUAGE_ID);        while ($lcur_res = $lcur->Fetch()) {            $arCurrency[] = array('VALUE' => $lcur_res['CURRENCY'], 'LANG' => $lcur_res['FULL_NAME']);        }        ?>        <div class="seprops_currency">        <?        $dbPriceType = GetCatalogGroups(Array("SORT" => "ASC"), Array());        while ($arPriceType = $dbPriceType->GetNext()) {            ?>                <p>                <?= $arPriceType['NAME_LANG'] ?>&nbsp;[<?= $arPriceType['NAME']; ?><? if ($arPriceType['BASE'] == 'Y') echo " (base)"; ?>]:&nbsp;                    <input type="text" name="OTHER_PRICE[<?= $arPriceType['ID'] ?>][PRICE]" style="width: 70px;" />                    <select name="OTHER_PRICE[<?= $arPriceType['ID'] ?>][CURRENCY]" id="">                    <? foreach ($arCurrency as $key => $value) { ?>                            <option value="<?= $value['VALUE'] ?>"><?= $value['VALUE'] ?>  (<?= $value['LANG'] ?>)</option>            <? } ?>                    </select>                </p>                    <? } ?>        </div>        <?    }} elseif ($_REQUEST['propID'] == 'PURCHASING_PRICE') {    ?>    &nbsp;<?= GetMessage('IBLOCKTOOLS_PURCHASING_PRICE'); ?>:&nbsp;<input type="text" value="" name="PURCHASING_PRICE" style="width:60px;" />&nbsp;<?= CCurrency::SelectBox("PURCHASING_CURRENCY", "RUB", "", True, "", "class='typeselect2'"); ?><? } elseif ($_REQUEST['propID'] == 'OTHER_QUANTITY') { ?>    <div class="seprops_quant">        <table>            <tr>                <td align="right"><?= GetMessage('IBLOCKTOOLS_OTHER_QUANTITY_INPUT') ?></td>                <td><input type="text" name="OTHER_QUANTITY" value="" /></td>            </tr>            <tr>                <td align="right" valign="top"><?= GetMessage('IBLOCKTOOLS_OTHER_QUANTITY_TRACE_INPUT') ?></td>                <td>                    <input type="radio" value="not_change" name="OTHER_QUANTITY_TRACE" id="OTHER_QUANTITY_TRACE_NOT_CHANGE" checked="checked" /><label for="OTHER_QUANTITY_TRACE_NOT_CHANGE">&nbsp;<?= GetMessage('IBLOCKTOOLS_OTHER_QUANTITY_TRACE_NOT_CNAHGE') ?></label><br />                    <input type="radio" value="Y" name="OTHER_QUANTITY_TRACE" id="OTHER_QUANTITY_TRACE_Y" /><label for="OTHER_QUANTITY_TRACE_Y">&nbsp;<?= GetMessage('IBLOCKTOOLS_OTHER_QUANTITY_TRACE_Y') ?></label><br />                    <input type="radio" value="N" name="OTHER_QUANTITY_TRACE" id="OTHER_QUANTITY_TRACE_N" /><label for="OTHER_QUANTITY_TRACE_N">&nbsp;<?= GetMessage('IBLOCKTOOLS_OTHER_QUANTITY_TRACE_N') ?></label>                </td>            </tr>        </table>    </div><? } elseif ($_REQUEST['propID'] == 'MEASURE') { ?>    <div class="seprops_quant">        <table>            <tr>                <td align="right"><?= GetMessage('IBLOCKTOOLS_MEASURE') ?>:</td>                <td>    <?    $arAllMeasure = array();    $dbResultList = CCatalogMeasure::getList(array(), array(), false, false, array("ID", "CODE", "MEASURE_TITLE", "SYMBOL_INTL", "IS_DEFAULT"));    while ($arMeasure = $dbResultList->Fetch()) {        $arAllMeasure[] = $arMeasure;    }    if (!empty($arAllMeasure)) {        ?>                        <select style="max-width:220px" name="MEASURE">                        <? foreach ($arAllMeasure as &$arMeasure) { ?>                                <option value="<?= $arMeasure["ID"] ?>"><?= htmlspecialcharsbx($arMeasure["MEASURE_TITLE"]) ?></option>                            <? } ?>                        </select>                        <? } ?>                </td>            </tr>            <tr>                <td align="right"><?= GetMessage('IBLOCKTOOLS_MEASURE_RATIO') ?>:</td>                <td><input type="text" name="MEASURE_RATIO" value="1" size="30" /></td>            </tr>        </table>    </div><? } elseif ($_REQUEST['propID'] == 'SIZE') { ?>    <div class="seprops_quant">        <table width="140">            <tr>                <td align="right"><?= GetMessage("IBLOCKTOOLS_SIZE_LENGTH") ?>:</td>                <td><input type="text" id="SIZE_LENGTH" name="SIZE[LENGTH]" value="0" size="30" /></td>            </tr>            <tr>                <td align="right"><?= GetMessage("IBLOCKTOOLS_SIZE_WIDTH") ?>:</td>                <td><input type="text" id="SIZE_WIDTH" name="SIZE[WIDTH]" value="0" size="30" /></td>            </tr>            <tr>                <td align="right"><?= GetMessage("IBLOCKTOOLS_SIZE_HEIGHT") ?>:</td>                <td><input type="text" id="SIZE_HEIGHT" name="SIZE[HEIGHT]" value="0" size="30" /></td>            </tr>            <tr>                <td align="right"><?= GetMessage("IBLOCKTOOLS_SIZE_WEIGHT") ?>:</td>                <td><input type="text" id="SIZE_WEIGHT" name="SIZE[WEIGHT]" value="0" size="30" /></td>            </tr>        </table>    </div><? } elseif ($_REQUEST['propID'] == 'CAN_BUY_ZERO' || $_REQUEST['propID'] == 'QUANTITY_TRACE' || $_REQUEST['propID'] == 'SUBSCRIBE') { ?>    <div class="seprops_quant">        &nbsp;        <select id="USE_ZERO_STORE_SUBSCRIBE" name="USE_ZERO_STORE_SUBSCRIBE">            <option value="">Не установлено</option>            <option value="Y">Да</option>            <option value="N">Нет</option>            <option value="D">По умолчанию</option>        </select>    </div><?} else {    $res = CIBlockProperty::GetByID($_REQUEST['propID'], $_REQUEST['iblockID'], false);    if ($ar_res = $res->GetNext()) {        $type = $ar_res['PROPERTY_TYPE'];        if ($ar_res['USER_TYPE']) {            $type .= ":" . $ar_res['USER_TYPE'];        }         _ShowPropertyField('PROP[' . $ar_res['ID'] . ']', $ar_res, $ar_res["VALUE"]);         if (0 && $ar_res['MULTIPLE'] == 'Y') {            ?>            <div id="seprops_multiple">                <input type="radio" name="seprops_multiple" id="seprops_multiple_c" value="CLEAR" /><label for="seprops_multiple_c">d<?= GetMessage('IBLOCKTOOLS_MULTIPLE_CLEAR') ?></label><br />                <input type="radio" name="seprops_multiple" id="seprops_multiple_u" value="UPDATE" checked="checked" /><label for="seprops_multiple_u"><?= GetMessage('IBLOCKTOOLS_MULTIPLE_UPDATE') ?></label>            </div>            <script>                $(function () {                    $('div#seprops_dest2>table>tbody>tr').append('<td valign="top">' + $('#seprops_multiple').html() + '</td>');                    $('#seprops_multiple').html('');                });            </script>        <? } ?>        <input type="hidden" name="seprops_dest_type" value="<?= $type ?>" />        <?    }} 